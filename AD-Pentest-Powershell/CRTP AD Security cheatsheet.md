


# Enumeration

**Domain Enumeration**

- Get Basic Information about Domain
  ```powershell
  Get-NetDomain

- Find the SID of the current Domain
  ```powershell
  Get-DomainSID

- Find the policy applicable to current domain
  ```powershell
  Get-DomainPolicy
  (Get-DomainPolicy)."Kerberos Policy"

- Find the DC Servers in current Domain
  ```powershell
  Get-NetDomainController
  Get-NetDomainController -Forest OrganicSecurity.local

- Enumerate Domain OU
  ```powershell
  Get-NetOU -FullData


**User, Group & Computer Object**

- Enumerate the Information about the Domain Users

  ```powershell
  Get-NetDomainUser

- Search the user attributes for specific terms

  ```powershell
  Find-UserField -SearchField Description -SearchTerm "Password"

- Find all the groups on the Current Domain

  ```powershell
  Get-NetGroup
  Get-NetGroup -Recurse

- Find Group Membership

  ```powershell
  Get-NetGroupMember -GroupName "EnterPrise Admins" -Domain "OrganicSecurity.local"

- Find local group created on the servers (requires admin rights for checking on non-dc machines)

  ```powershell
  Get-NetLocalGroup -Computername <dc>

- Get the list of Computer Objects

  ```powershell
  Get-NetComputer

**Shares & Juicy Files**

- Identify the shares in current domain

  ```powershell
  Invoke-ShareFinder

- Identify juicy files accessible over the shared folder

  ```powershell
  Invoke-FileFinder

- Find File servers in current domain

  ```powershell
  Get-FileNetServer


**User Hunting**

- Find session of logged on users on the server

  ```powershell
  Get-NetLoggedOn <computer-name>
  (Get-NetComputer -FullData).foreach({Get-NetLoggedOn $_.cn})

- Find last logged on user on the remote machine

  ```powershell
  Get-LastLoggedOn -ComputerName <servername>

- Find all the local admin accounts on all the machines (Required Admin rights on non-dc machines)

  ```powershell
  Invoke-EnumerateLocalAdmin | select ComputerName, AccountName, IsDomain, IsAdmin

- Find Local Admin rights for current user

  ```powershell
  Find-LocalAdminAccess
  Invoke-CheckLocalAdminAccess
  Invoke-CheckLocalAdminAccess -ComputerName <server_fqdn>

- Find the computers where Domain Admin or specified User/Group has active session

  ```powershell
  Invoke-UserHunter

- "stealth" option only checks for session on only High Value Servers

  ```powershell
  Invoke-UserHunter -stealth

- Check for Powershell Remoting access for current user

  ```powershell
  Find-PSRemotingLocalAdminAccess -ComputerName <server_fqdn>

- Check for Remote Access via WMI for current user

  ```powershell
  Find-WMILocalAdminAccess -ComputerName <server_fqdn>


**GPO Enumeration**

- Find all the GPO configured in a given domain

  ```powershell
  Get-NetGPO | select displayname
  Get-NetGPO -ComputerName <server_fqdn>

-Find the GPOs applied on a specific OU in the domain

  ```powershell
  Get-NetOU -FullData | select ou,pglink
  Get-NetGPO -GPOName "{GPO_ID}"


- Find If there is GPO configured which is using Restricted Groups via groups.xml to assign local admin membership

  ```powershell
  Get-NetGPOGroup

- Find machines where the given user is member of a specific group

  ```powershell
  Get-GPOLocation -UserName <username> 


**Access Control Model (ACL)**

- Fetch all the ACL associated with a given user account

  ```powershell
  Get-ObjectAcl -SamAccountName <username> | select AccessControlType, IdentityReference, ActiveDirectoryRights

- Fetch all the ACL by ADSPath for any AD Object

  ```powershell
  Get-ObjectAcl -ADSPath "LDAP://CN={73267-86872-368732},CN=Policies,CN=System,DC=organicsecurity,DC=local"

- Fetch all the ACL by ADSPrefix 
  ```powershell
  Get-ObjectAcl -ADSPrefix "CN=Administrator,CN=Users"

- Use below command to find all the interesting ACEs

  ```powershell
  Invoke-ACLScanner | select AccessControlType, IdentityReference, ActiveDirectoryRights, ObjectDN

- Identify the ACL associated with the specified path

  ```powershell
  GetPathAcl -Path "\\dc.organicsecurity.local\sysvol"

**Forest & Domain Trusts**

- Enumerate Trust of current domain

  ```powershell
  Get-NetDomainTrust

- Enumerate Current Forest, and its domain

  ```powershell
  Get-NetForest
  Get-NetForest -Forest organicsecurity.local

- Enumerate all the domains under given forest

  ```powershell
  Get-NetForestDomain

- Find the Global Catalouge for given forest

  ```powershell
  Get-NetForestCatalog

- Find the forest trust

  ```powershell
  Get-NetForestTrust -Forest organicsecurity.local

**BloodHound & SharpHound**

- Install neo4j service
  
    ```powershell
  .\neo4j.bat install-service
  net start neo4j

  . .\Sharhound.ps1
  Invoke-BloodHound -CollectionMethod All




